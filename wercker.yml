box: debian:sid
build:
  steps:
    - script:
        name: apt
        code: |
          apt-get update || (sleep 3 && apt-get update)
          DEBIAN_FRONTEND="noninteractive" apt-get install -y wget curl git make gcc build-essential perl
    - script:
        name: make deps
        code: |
          make deps
    - script:
        name: make test
        code: |
#          make test
    - script:
        name: cleanup
        code: |
          rm -fr deps local/furuike/deps
          rm -fr t t_deps local/furuike/t local/furuike/t_deps
deploy:
  steps:
#    - wercker/add-to-known_hosts@1.4.0:
#        hostname: bitbucket.org
    - internal/docker-push:
        username: $DOCKER_HUB_USERNAME
        password: $DOCKER_HUB_PASSWORD
        tag: latest
        repository: wakaba/suikaweb
        registry: https://registry.hub.docker.com
